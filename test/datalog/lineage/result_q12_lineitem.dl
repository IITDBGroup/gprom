QSHIPMODES('SHIP').
QSHIPMODES('MAIL').

Q1(L_OKEY,L_LINENUMBER,L_SHIPMODE) :-
    LINEITEM(L_OKEY,X8,X9,L_LINENUMBER,X11,X12,X13,X14,X15,X16,L_SHIPDATE,L_COMMITDATE,L_RECEIPTDATE,X17,L_SHIPMODE,X18),
    ((L_COMMITDATE < L_RECEIPTDATE)),
    ((L_SHIPDATE < L_COMMITDATE)),
    ((L_RECEIPTDATE >= '1994-01-01')),
    ((L_RECEIPTDATE < '1995-01-01')),
    QSHIPMODES(L_SHIPMODE).

Q(L_SHIPMODE,sum((CASE  WHEN (O_ORDERPRIORITY = '1-URGENT') THEN 1 WHEN (O_ORDERPRIORITY = '2-HIGH') THEN 1 ELSE 0 END)),sum((CASE  WHEN (O_ORDERPRIORITY <> '1-URGENT') THEN (CASE  WHEN (O_ORDERPRIORITY <> '2-HIGH') THEN 1 ELSE 0 END) ELSE 0 END))) :-
    ORDERS(O_OKEY,X1,X2,X3,X4,O_ORDERPRIORITY,X5,X6,X7),Q1(O_OKEY,L_LINENUMBER,L_SHIPMODE).

RP(X1,X2,X3) :-
    RTPCQ12(X1,X2,X3).

PROV_Q1(O_OKEY,L_LINENUMBER,L_SHIPMODE) :-
    ORDERS(O_OKEY,X1,X2,X3,X4,O_ORDERPRIORITY,X5,X6,X7),
    Q1(O_OKEY,L_LINENUMBER,L_SHIPMODE),
    RP(L_SHIPMODE,V2,V3).

PROV_LINEITEM(L_OKEY,X8,X9,L_LINENUMBER,X11,X12,X13,X14,X15,X16,L_SHIPDATE,L_COMMITDATE,L_RECEIPTDATE,X17,L_SHIPMODE,X18) :-
    LINEITEM(L_OKEY,X8,X9,L_LINENUMBER,X11,X12,X13,X14,X15,X16,L_SHIPDATE,L_COMMITDATE,L_RECEIPTDATE,X17,L_SHIPMODE,X18),
    ((L_COMMITDATE < L_RECEIPTDATE)),
    ((L_SHIPDATE < L_COMMITDATE)),
    ((L_RECEIPTDATE >= '1994-01-01')),
    ((L_RECEIPTDATE < '1995-01-01')),
    QSHIPMODES(L_SHIPMODE),
    PROV_Q1(L_OKEY,L_LINENUMBER,L_SHIPMODE).


ANS: PROV_LINEITEM.
